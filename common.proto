syntax = "proto3";

option go_package = ".;pb";

package common;

// Identity is included in every message that requires auth. One AuthMethod at a
// time is supported. For now, the only supported method is a token. These need
// to be created manually and distributed to any clients.
message Identity {
  oneof AuthMethod {
    string token = 1;
  }
}

message User {
  string id = 1;
  string name = 2;
}

message Service {
  string id = 1;
  string name = 2;
  // TODO
}

message Channel {
  string id = 1;
  string name = 2;
  string service_id = 3;
}

message MessageEvent {
  string source_id = 1;
  string user_id = 2;
  string text = 3;
}

message PrivateMessageEvent {
  string source_id = 1;
  string user_id = 2;
  string text = 3;
}

message MentionEvent {
  string source_id = 1;
  string user_id = 2;
  string text = 3;
}

message CommandEvent {
  string source_id = 1;
  string user_id = 2;
  string command = 3;
  string arg = 4;
}

message Event {
  oneof inner {
    common.MessageEvent text = 1;
    common.PrivateMessageEvent private_message = 2;
    common.MentionEvent mention = 3;
    common.CommandEvent command = 4;
  }
}

message HeartbeatRequest {
  common.Identity identity = 1;

  string nonce = 2;
}

message HeartbeatResponse {
  string nonce = 2;
}
